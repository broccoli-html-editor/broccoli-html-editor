<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Broccoli TEST</title>
	</head>
	<body>
		<div class="canvas">
			<iframe src="/editpage/index.html"></iframe>
			<div id="panels"></div>
		</div>
		<div id="palette">module palette.</div>

		<!-- jQuery -->
		<script src="jquery-1.11.1.min.js" type="text/javascript"></script>

		<!-- socket.io -->
		<script src="/socket.io/socket.io.js" type="text/javascript"></script>

		<!-- baobab-fw -->
		<script src="/baobab-fw/baobab-fw.js" type="text/javascript"></script>

		<!-- broccoli -->
		<script src="./broccoli.js"></script>
		<script type="text/javascript">
			// console.log(broccoli);

/**
 * main.js
 */
window.main = new (function(){
	var _this = this;
	var socket = this.socket = window.baobabFw
		.createSocket(
			this,
			io,
			{
				'showSocketTest': function( data, callback, main, socket ){
					// console.log(data);
					// alert(data.message);
					// console.log(callback);
					callback(data);
					return;
				}
			}
		)
	;

	this.init = function(){
		// this.socketTest();
		_this.socket.send(
			'broccoli',
			{
				'api': 'getPackageList'
			},
			function(packageList){
				console.log(packageList);
				broccoli.drawModulePalette(packageList, document.getElementById('palette'), function(){
					console.log('palette standby.');

					_this.socket.send(
						'broccoli',
						{
							'api': 'buildHtml'
						},
						function(html){
							// console.log(html);
							$('.contents', $('iframe').get(0).contentWindow.document).html(html);

							console.log('HTML standby.');
						}
					);

				});
			}
		);
	}

	/**
	 * WebSocket疎通確認
	 */
	this.socketTest = function(){
		socket.send(
			'socketTest',
			{'message': 'socketTest from frontend.'} ,
			function(data){
				console.log(data);
				// alert('callback function is called!');
			}
		);
		return this;
	}

})();
main.init();

		</script>
	</body>
</html>
