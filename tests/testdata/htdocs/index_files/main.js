/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={1808:(t,e,n)=>{!function(t){var e=n(6964).Promise;t.exports=function(t,n,i){var r=1;return arguments.length>=4&&(t=arguments[0],r=arguments[1],n=arguments[arguments.length-2],i=arguments[arguments.length-1]),new function(t,n,i,r){for(var o in this.idx=-1,this.idxs=[],t)this.idxs.push(o);this.bundle=n||1,this.bundleProgress=1,this.ary=t||[],this.fnc=i||function(){},this.completed=!1,this.fncComplete=r||function(){},this.next=function(){var t=this;return new e(function(t){t()}).then(function(){return new e(function(e,n){if(t.bundleProgress--,!(t.bundleProgress>0))if(t.idx+1>=t.idxs.length&&t.bundleProgress<=0)t.destroy();else{var i=t.idx;t.idx=t.idx+t.bundle;for(var r=0;r<t.bundle&&!(++i>=t.idxs.length);r++)t.bundleProgress++,t.fnc(t,t.ary[t.idxs[i]],t.idxs[i])}})}),this},this.break=function(){this.destroy()},this.destroy=function(){var t=this;t.idx=t.idxs.length-1,t.bundleProgress=0,t.completed||(t.completed=!0,t.fncComplete())},this.next()}(t,r=r||1,n,i)}}(t=n.nmd(t))},4665:(t,e,n)=>{var i=n(6964).Promise;t.exports=function(t){var e,r={},o=[],s=[],c={};(r=t||{}).process=t.process||function(t,e){e()},r.threadLimit=t.threadLimit||1;for(var u=0;u<r.threadLimit;u++)s.push({active:!1});function a(t){t=t.toString();var e=n(8459).createHash("md5");return e.update(t,"utf8"),e.digest("hex")}function l(){clearTimeout(e),o.length&&new i(function(t){t()}).then(function(){return new i(function(t,n){var i=!1;for(var u in s)if(!s[u].active){s[i=u].active=!0;break}if(!1!==i){var a=o.shift();if(99==c[a.id])return c[a.id]=void 0,delete c[a.id],s[i].active=!1,void l();c[a.id]=2,s[i].active=a.id,r.process(a.data,function(){c[a.id]=void 0,delete c[a.id],s[i].active=!1,l()},{id:a.id})}else e=setTimeout(function(){l()},10)})})}this.push=function(t){for(var e;;){var n=(new Date).getTime();if(e=n+"-"+a(n),!c[e])break}return o.push({id:e,data:t}),c[e]=1,l(),e},this.update=function(t,e){if("waiting"!=this.checkStatus(t))return!1;for(var n in o)if(o[n].id==t){o[n].data=e;break}return!0},this.remove=function(t){return"waiting"==this.checkStatus(t)&&(c[t]=99,!0)},this.checkStatus=function(t){c[t];switch(c[t]){case 1:return"waiting";case 2:return"progressing";case 99:return"removed"}return"undefined"},this.getAllStatus=function(){return c}}},5606:t=>{var e,n,i=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(e===setTimeout)return setTimeout(t,0);if((e===r||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:r}catch(t){e=r}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var c,u=[],a=!1,l=-1;function f(){a&&c&&(a=!1,c.length?u=c.concat(u):l=-1,u.length&&h())}function h(){if(!a){var t=s(f);a=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,a=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{return n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new d(t,e)),1!==u.length||a||s(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},5683:(t,e,n)=>{!function(t){var e=n(6964).Promise;t.exports=function(t){var n="explicit",i=void 0;arguments.length>=2&&(n="implicit",i=arguments[0],t=arguments[arguments.length-1]);var r=new function(t){t=t||[];var n=this;for(var i in n.idx=0,n.idxs=[],t)n.idxs.push(i);for(var i in n.idxsidxs={},n.idxs)n.idxsidxs[n.idxs[i]]=i;n.funcs=t;var r=!1;this.start=function(t){var n=this;r||(r=!0,new e(function(t){t()}).then(function(){return new e(function(e,i){n.next(t)})}))},this.next=function(t){var n=this;t=t||{},n.idxs.length<=n.idx||new e(function(t){t()}).then(function(){return new e(function(e,i){n.funcs[n.idxs[n.idx++]](n,t)})})},this.goto=function(t,n){var i=this;i.idx=i.idxsidxs[t],n=n||{},i.idxs.length<=i.idx||new e(function(t){t()}).then(function(){return new e(function(t,e){i.funcs[i.idxs[i.idx++]](i,n)})})},this.break=function(){this.destroy()},this.destroy=function(){}}(t);return"implicit"==n?(r.start(i),r):r}}(t=n.nmd(t))},6809:(t,e,n)=>{!function(t){t.exports.ary=n(1808),t.exports.fnc=n(5683),t.exports.queue=n(4665)}(t=n.nmd(t))},6964:function(t,e,n){var i=n(5606);t.exports=function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}var r=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=0,s=void 0,c=void 0,u=function(t,e){b[o]=t,b[o+1]=e,2===(o+=2)&&(c?c(x):A())};function a(t){c=t}function l(t){u=t}var f="undefined"!=typeof window?window:void 0,h=f||{},d=h.MutationObserver||h.WebKitMutationObserver,p="undefined"==typeof self&&void 0!==i&&"[object process]"==={}.toString.call(i),v="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function g(){return function(){return i.nextTick(x)}}function m(){return function(){s(x)}}function w(){var t=0,e=new d(x),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function _(){var t=new MessageChannel;return t.port1.onmessage=x,function(){return t.port2.postMessage(0)}}function y(){var t=setTimeout;return function(){return t(x,1)}}var b=new Array(1e3);function x(){for(var t=0;t<o;t+=2)(0,b[t])(b[t+1]),b[t]=void 0,b[t+1]=void 0;o=0}function T(){try{var t=n(9007);return s=t.runOnLoop||t.runOnContext,m()}catch(t){return y()}}var A=void 0;function P(t,e){var n=arguments,i=this,r=new this.constructor(S);void 0===r[E]&&X(r);var o,s=i._state;return s?(o=n[s-1],u(function(){return q(s,r,o,i._result)})):J(i,r,t,e),r}function k(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(S);return I(n,t),n}A=p?g():d?w():v?_():void 0===f?T():y();var E=Math.random().toString(36).substring(16);function S(){}var j=void 0,$=1,C=2,M=new Z;function O(){return new TypeError("You cannot resolve a promise with itself")}function L(){return new TypeError("A promises callback cannot return that same promise.")}function V(t){try{return t.then}catch(t){return M.error=t,M}}function z(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}function D(t,e,n){u(function(t){var i=!1,r=z(n,e,function(n){i||(i=!0,e!==n?I(t,n):G(t,n))},function(e){i||(i=!0,W(t,e))},"Settle: "+(t._label||" unknown promise"));!i&&r&&(i=!0,W(t,r))},t)}function F(t,e){e._state===$?G(t,e._result):e._state===C?W(t,e._result):J(e,void 0,function(e){return I(t,e)},function(e){return W(t,e)})}function R(t,n,i){n.constructor===t.constructor&&i===P&&n.constructor.resolve===k?F(t,n):i===M?W(t,M.error):void 0===i?G(t,n):e(i)?D(t,n,i):G(t,n)}function I(e,n){e===n?W(e,O()):t(n)?R(e,n,V(n)):G(e,n)}function B(t){t._onerror&&t._onerror(t._result),N(t)}function G(t,e){t._state===j&&(t._result=e,t._state=$,0!==t._subscribers.length&&u(N,t))}function W(t,e){t._state===j&&(t._state=C,t._result=e,u(B,t))}function J(t,e,n,i){var r=t._subscribers,o=r.length;t._onerror=null,r[o]=e,r[o+$]=n,r[o+C]=i,0===o&&t._state&&u(N,t)}function N(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,r=void 0,o=t._result,s=0;s<e.length;s+=3)i=e[s],r=e[s+n],i?q(n,i,r,o):r(o);t._subscribers.length=0}}function Z(){this.error=null}var U=new Z;function Y(t,e){try{return t(e)}catch(t){return U.error=t,U}}function q(t,n,i,r){var o=e(i),s=void 0,c=void 0,u=void 0,a=void 0;if(o){if((s=Y(i,r))===U?(a=!0,c=s.error,s=null):u=!0,n===s)return void W(n,L())}else s=r,u=!0;n._state!==j||(o&&u?I(n,s):a?W(n,c):t===$?G(n,s):t===C&&W(n,s))}function K(t,e){try{e(function(e){I(t,e)},function(e){W(t,e)})}catch(e){W(t,e)}}var H=0;function Q(){return H++}function X(t){t[E]=H++,t._state=void 0,t._result=void 0,t._subscribers=[]}function tt(t,e){this._instanceConstructor=t,this.promise=new t(S),this.promise[E]||X(this.promise),r(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?G(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&G(this.promise,this._result))):W(this.promise,et())}function et(){return new Error("Array Methods must be provided an Array")}function nt(t){return new tt(this,t).promise}function it(t){var e=this;return r(t)?new e(function(n,i){for(var r=t.length,o=0;o<r;o++)e.resolve(t[o]).then(n,i)}):new e(function(t,e){return e(new TypeError("You must pass an array to race."))})}function rt(t){var e=new this(S);return W(e,t),e}function ot(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function st(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function ct(t){this[E]=Q(),this._result=this._state=void 0,this._subscribers=[],S!==t&&("function"!=typeof t&&ot(),this instanceof ct?K(this,t):st())}function ut(){var t=void 0;if(void 0!==n.g)t=n.g;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=ct}return tt.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===j&&n<t;n++)this._eachEntry(e[n],n)},tt.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===k){var r=V(t);if(r===P&&t._state!==j)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(n===ct){var o=new n(S);R(o,t,r),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(i(t),e)},tt.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===j&&(this._remaining--,t===C?W(i,n):this._result[e]=n),0===this._remaining&&G(i,this._result)},tt.prototype._willSettleAt=function(t,e){var n=this;J(t,void 0,function(t){return n._settledAt($,e,t)},function(t){return n._settledAt(C,e,t)})},ct.all=nt,ct.race=it,ct.resolve=k,ct.reject=rt,ct._setScheduler=a,ct._setAsap=l,ct._asap=u,ct.prototype={constructor:ct,then:P,catch:function(t){return this.then(null,t)}},ut(),ct.polyfill=ut,ct.Promise=ct,ct}()},8459:()=>{},9007:()=>{}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),window.main=new function(){var t;n(6809);window.biflora&&(t=this.socket=window.biflora.createSocket(this,io,{showSocketTest:function(t,e,n,i){e(t)}}));var e,i="biflora",r=new Broccoli;this.broccoli=window.broccoli=r,e=$(window).height()-70,$(".instanceTreeView").css({height:e}),$(".canvas").css({height:e}),$(".palette").css({height:e}),this.init=function(e,n){n=n||function(){},(e=e||{}).serverType&&(i=e.serverType),r.init({elmCanvas:$(".canvas").get(0),elmModulePalette:$(".palette").get(0),elmInstancePathView:$(".instancePathView").get(0),elmInstanceTreeView:$(".instanceTreeView").get(0),contents_area_selector:"[data-contents]",contents_bowl_name_by:"data-contents",lang:e.lang||"ja",appearance:window.optionsAppearance,customFields:{custom1:window.custom1,custom2:window.custom2},customValidationRules:{customValidation1:function(t,e,n,i){console.log("---- customValidation1"),console.log(t,e,n),"customvalidation"==t?i():i(!1,"The "+n+" is not valid.")}},droppedFileOperator:{jpg:function(t,e){console.log("tests/main.js: JPEG Operator",t);var n=t.type,i=t.size,r=t.name,o=r,s="png";r.match(/^(.*)\.([a-zA-Z0-9\_]+)$/i)&&(o=RegExp.$1,s=(s=RegExp.$2).toLowerCase());var c=new FileReader;c.onload=function(t){var r=t.target.result;o=o.split(/[^a-zA-Z0-9]/).join("_");var c=r.replace(/^data\:[a-zA-Z0-9]+\/[a-zA-Z0-9]+\;base64\,/i,"");e({data:[{modId:"_sys/image",fields:{src:{resKey:"___dropped_local_image___",path:"",resType:"",webUrl:""},alt:"JPEGドロップ"}}],resources:{___dropped_local_image___:{ext:s,type:n,size:i,base64:c,isPrivateMaterial:!1,publicFilename:o,md5:"",field:"image",fieldNote:{}}}})},c.readAsDataURL(t)},dropcancel:function(t,e){console.log("------ *.dropcancel dropped;",t),e(!1)}},gpiBridge:function(e,n,r){console.info("=----= GPI Request =----=",e,n);var o=(new Date).getTime();if("biflora"==i)t.send("broccoli",{api:"gpiBridge",bridge:{api:e,options:n}},function(t){console.info("-- GPI result",(new Date).getTime()-o,t),r(t)});else if("php"==i){var s;$.ajax({url:"./_api.php",method:"post",data:{api:e,options:JSON.stringify(n)},success:function(t){try{s=JSON.parse(t)}catch(e){console.error(e,t)}},error:function(t){console.error(t)},complete:function(){console.info("-- GPI result",(new Date).getTime()-o,s),r(s)}})}},onClickContentsLink:function(t,e){return alert(t+" へ移動"),console.log(e),!1},onMessage:function(t){console.info("message: "+t),px2style.flashMessage(t)},onEditWindowOpen:function(t,e){console.info("onEditWindowOpen():",t,e)},onEditWindowClose:function(t,e){console.info("onEditWindowClose():",t,e)},enableModuleAnchor:!0,enableModuleDec:!0},function(){console.log("broccoli standby."),$(window).resize(function(){var t=$(window).height()-70;$(".instanceTreeView").css({height:t}),$(".canvas").css({height:t}),$(".palette").css({height:t}),r.adjust()}),n()})},this.socketTest=function(){return t.send("socketTest",{message:"socketTest from frontend."},function(t){console.log(t)}),this},this.reloadBroccoli=function(){this.init({serverType:i},function(){console.log("TestPage: Re-initialize Broccoli: done")})}}})();